# API Reference - eSIM Plus Management System\n\nComprehensive REST API documentation for the eSIM Plus Management System.\n\n## Base URL\n\n```\nhttp://localhost:8001\n```\n\n## Authentication\n\nAll API endpoints (except health check and login) require JWT authentication:\n\n```http\nAuthorization: Bearer <jwt_token>\n```\n\n## Error Responses\n\nStandard error response format:\n\n```json\n{\n  \"detail\": \"Error message\",\n  \"status_code\": 400\n}\n```\n\n## Endpoints\n\n### System Health\n\n#### GET /api/health\n\nCheck system health and database connectivity.\n\n**Response:**\n```json\n{\n  \"status\": \"healthy\",\n  \"database\": \"connected\",\n  \"collections\": {\n    \"esim_profiles\": 0,\n    \"users\": 0,\n    \"tenants\": 0,\n    \"compliance_logs\": 0\n  },\n  \"timestamp\": \"2025-09-29T16:17:26.395541\"\n}\n```\n\n### Authentication\n\n#### POST /api/auth/login\n\nAuthenticate user and receive JWT token.\n\n**Parameters:**\n- `username` (string, required): User's username\n- `password` (string, required): User's password\n\n**Request:**\n```http\nPOST /api/auth/login?username=admin&password=securepassword\n```\n\n**Response:**\n```json\n{\n  \"access_token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...\",\n  \"token_type\": \"bearer\",\n  \"user\": {\n    \"id\": \"user-uuid\",\n    \"username\": \"admin\",\n    \"role\": \"admin\",\n    \"tenantId\": \"tenant-uuid\",\n    \"fullName\": \"System Administrator\"\n  }\n}\n```\n\n### Tenant Management\n\n#### POST /api/tenants/create\n\nCreate new tenant (Admin only).\n\n**Request Body:**\n```json\n{\n  \"name\": \"MPT Myanmar\",\n  \"provider\": \"MPT\",\n  \"adminIdentity\": \"admin@esimplus.onmicrosoft.com\",\n  \"entitlementServerUrl\": \"https://entitlement.mpt.com\",\n  \"settings\": {\n    \"allowDeviceMigration\": true,\n    \"qrCodeExpiryHours\": 24\n  }\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Tenant created successfully\",\n  \"tenant\": {\n    \"id\": \"tenant-uuid\",\n    \"name\": \"MPT Myanmar\",\n    \"provider\": \"MPT\",\n    \"isActive\": true,\n    \"createdAt\": \"2025-09-29T16:00:00Z\"\n  }\n}\n```\n\n#### GET /api/tenants/list\n\nList all tenants (Admin only).\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"tenants\": [\n    {\n      \"id\": \"tenant-uuid\",\n      \"name\": \"MPT Myanmar\",\n      \"provider\": \"MPT\",\n      \"isActive\": true,\n      \"createdAt\": \"2025-09-29T16:00:00Z\"\n    }\n  ],\n  \"total\": 1\n}\n```\n\n### eSIM Profile Management\n\n#### POST /api/esim/create\n\nCreate new eSIM profile.\n\n**Request Body:**\n```json\n{\n  \"tenantId\": \"tenant-uuid\",\n  \"displayName\": \"Corporate eSIM - MPT\",\n  \"description\": \"eSIM profile for corporate devices\",\n  \"activationCode\": \"LPA:1$smdp.mpt.com.mm$matching_id\",\n  \"smdpServerUrl\": \"https://smdp.mpt.com.mm\",\n  \"provider\": \"MPT\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"eSIM profile created successfully\",\n  \"profileId\": \"profile-uuid\",\n  \"profile\": {\n    \"id\": \"profile-uuid\",\n    \"tenantId\": \"tenant-uuid\",\n    \"displayName\": \"Corporate eSIM - MPT\",\n    \"provider\": \"MPT\",\n    \"status\": \"created\",\n    \"qrCodeId\": \"qr-uuid\",\n    \"createdAt\": \"2025-09-29T16:00:00Z\"\n  },\n  \"qrCode\": {\n    \"id\": \"qr-uuid\",\n    \"qrData\": \"LPA:1$smdp.mpt.com.mm$matching_id\",\n    \"imageBase64\": \"iVBORw0KGgoAAAANSUhEUgAA...\",\n    \"expiresAt\": \"2025-09-30T16:00:00Z\"\n  }\n}\n```\n\n#### GET /api/esim/list\n\nList eSIM profiles with tenant isolation.\n\n**Query Parameters:**\n- `skip` (integer): Number of records to skip (default: 0)\n- `limit` (integer): Maximum records to return (default: 100)\n- `provider` (string): Filter by provider (MPT, ATOM, OOREDOO, MYTEL)\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"profiles\": [\n    {\n      \"id\": \"profile-uuid\",\n      \"displayName\": \"Corporate eSIM - MPT\",\n      \"provider\": \"MPT\",\n      \"status\": \"deployed\",\n      \"createdAt\": \"2025-09-29T16:00:00Z\"\n    }\n  ],\n  \"total\": 1,\n  \"skip\": 0,\n  \"limit\": 100,\n  \"tenantId\": \"tenant-uuid\"\n}\n```\n\n#### GET /api/esim/{profile_id}\n\nGet specific eSIM profile.\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"profile\": {\n    \"id\": \"profile-uuid\",\n    \"tenantId\": \"tenant-uuid\",\n    \"displayName\": \"Corporate eSIM - MPT\",\n    \"description\": \"eSIM profile for corporate devices\",\n    \"activationCode\": \"LPA:1$smdp.mpt.com.mm$matching_id\",\n    \"smdpServerUrl\": \"https://smdp.mpt.com.mm\",\n    \"provider\": \"MPT\",\n    \"status\": \"deployed\",\n    \"deviceId\": \"device-uuid\",\n    \"createdAt\": \"2025-09-29T16:00:00Z\",\n    \"updatedAt\": \"2025-09-29T16:30:00Z\"\n  }\n}\n```\n\n#### POST /api/esim/deploy\n\nDeploy eSIM profile to Microsoft Intune.\n\n**Request Body:**\n```json\n{\n  \"profileId\": \"profile-uuid\",\n  \"targetDeviceId\": \"device-uuid\",\n  \"deploymentNotes\": \"Initial deployment for new employee device\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"eSIM profile deployed successfully\",\n  \"profileId\": \"profile-uuid\",\n  \"deploymentResult\": {\n    \"success\": true,\n    \"stdout\": \"SUCCESS: eSIM profile deployment completed\\n{...}\",\n    \"returncode\": 0\n  }\n}\n```\n\n### QR Code Management\n\n#### GET /api/qr/{profile_id}\n\nGet QR code for eSIM profile.\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"qrCode\": {\n    \"id\": \"qr-uuid\",\n    \"profileId\": \"profile-uuid\",\n    \"qrData\": \"LPA:1$smdp.mpt.com.mm$matching_id\",\n    \"imageBase64\": \"iVBORw0KGgoAAAANSUhEUgAA...\",\n    \"expiresAt\": \"2025-09-30T16:00:00Z\",\n    \"isActive\": true,\n    \"createdAt\": \"2025-09-29T16:00:00Z\"\n  }\n}\n```\n\n### Device Migration\n\n#### POST /api/migration/initiate\n\nInitiate device migration for eSIM profile.\n\n**Request Body:**\n```json\n{\n  \"profileId\": \"profile-uuid\",\n  \"sourceDeviceId\": \"old-device-uuid\",\n  \"targetDeviceId\": \"new-device-uuid\",\n  \"migrationNotes\": \"Employee device upgrade\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Device migration initiated successfully\",\n  \"migration\": {\n    \"id\": \"migration-uuid\",\n    \"profileId\": \"profile-uuid\",\n    \"sourceDeviceId\": \"old-device-uuid\",\n    \"targetDeviceId\": \"new-device-uuid\",\n    \"status\": \"pending\",\n    \"initiatedBy\": \"user-uuid\",\n    \"createdAt\": \"2025-09-29T16:00:00Z\"\n  }\n}\n```\n\n### Compliance & Audit\n\n#### GET /api/compliance/logs\n\nGet compliance audit logs (Admin only).\n\n**Query Parameters:**\n- `skip` (integer): Number of records to skip (default: 0)\n- `limit` (integer): Maximum records to return (default: 100)\n- `operation` (string): Filter by operation type\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"logs\": [\n    {\n      \"id\": \"log-uuid\",\n      \"tenantId\": \"tenant-uuid\",\n      \"operation\": \"CREATE_PROFILE\",\n      \"resourceType\": \"esim_profile\",\n      \"resourceId\": \"profile-uuid\",\n      \"userId\": \"user-uuid\",\n      \"userRole\": \"operator\",\n      \"timestamp\": \"2025-09-29T16:00:00Z\",\n      \"details\": {\n        \"profileName\": \"Corporate eSIM - MPT\",\n        \"provider\": \"MPT\"\n      },\n      \"complianceStatus\": \"compliant\"\n    }\n  ],\n  \"total\": 1,\n  \"skip\": 0,\n  \"limit\": 100\n}\n```\n\n## Error Codes\n\n| Status Code | Description |\n|-------------|-------------|\n| 200 | Success |\n| 400 | Bad Request - Invalid parameters |\n| 401 | Unauthorized - Invalid or missing token |\n| 403 | Forbidden - Insufficient permissions |\n| 404 | Not Found - Resource not found |\n| 422 | Validation Error - Invalid request body |\n| 500 | Internal Server Error |\n| 503 | Service Unavailable - Database connection issues |\n\n## Rate Limiting\n\nAPI endpoints are rate limited to prevent abuse:\n- **Standard endpoints**: 100 requests per minute per user\n- **Deployment endpoints**: 10 requests per minute per user\n- **Admin endpoints**: 50 requests per minute per user\n\n## RBAC Permissions\n\n| Endpoint | Admin | Operator | Viewer |\n|----------|-------|----------|--------|\n| GET /api/health | ✅ | ✅ | ✅ |\n| POST /api/auth/login | ✅ | ✅ | ✅ |\n| POST /api/tenants/create | ✅ | ❌ | ❌ |\n| GET /api/tenants/list | ✅ | ❌ | ❌ |\n| POST /api/esim/create | ✅ | ✅ | ❌ |\n| GET /api/esim/list | ✅ | ✅ | ✅ |\n| GET /api/esim/{id} | ✅ | ✅ | ✅ |\n| POST /api/esim/deploy | ✅ | ✅ | ❌ |\n| POST /api/migration/initiate | ✅ | ✅ | ❌ |\n| GET /api/compliance/logs | ✅ | ❌ | ❌ |\n\n---\n\n**All endpoints enforce multi-tenant isolation automatically based on user's tenant context**